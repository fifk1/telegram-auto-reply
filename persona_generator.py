"""
Генератор персон для Telegram аккаунтов
Автоматически создает уникальные личности с именами, городами, характерами и промптами
"""

import random
from typing import Dict, Optional
from datetime import datetime


# Списки для генерации персон
MALE_NAMES = [
    "Алексей", "Дмитрий", "Иван", "Максим", "Андрей", "Артем", "Сергей", "Никита",
    "Егор", "Михаил", "Денис", "Владимир", "Роман", "Павел", "Кирилл", "Александр",
    "Константин", "Даниил", "Илья", "Антон", "Матвей", "Тимофей", "Глеб", "Виктор",
    "Олег", "Григорий", "Вадим", "Игорь", "Станислав", "Руслан", "Ярослав", "Борис",
    "Юрий", "Евгений", "Федор", "Петр", "Николай", "Семен", "Леонид", "Арсений"
]

FEMALE_NAMES = [
    "Анна", "Мария", "Екатерина", "Дарья", "Анастасия", "Полина", "Ольга", "Елена",
    "Ирина", "Светлана", "Наталья", "Юлия", "Виктория", "Александра", "Татьяна",
    "София", "Алиса", "Ксения", "Валерия", "Арина", "Вероника", "Милана", "Кристина",
    "Марина", "Диана", "Евгения", "Карина", "Маргарита", "Любовь", "Надежда",
    "Вера", "Алина", "Елизавета", "Варвара", "Ульяна", "Яна", "Людмила"
]

RUSSIAN_CITIES = [
    "Москва", "Санкт-Петербург", "Новосибирск", "Екатеринбург", "Казань", "Нижний Новгород",
    "Челябинск", "Самара", "Омск", "Ростов-на-Дону", "Уфа", "Красноярск", "Воронеж",
    "Пермь", "Волгоград", "Краснодар", "Саратов", "Тюмень", "Тольятти", "Ижевск",
    "Барнаул", "Ульяновск", "Иркутск", "Хабаровск", "Ярославль", "Владивосток",
    "Махачкала", "Томск", "Оренбург", "Кемерово", "Новокузнецк", "Рязань", "Астрахань",
    "Пенза", "Липецк", "Тула", "Киров", "Чебоксары", "Калининград", "Брянск",
    "Курск", "Иваново", "Магнитогорск", "Тверь", "Ставрополь", "Сочи", "Владимир"
]

# Характеры и стили общения
CHARACTERS = [
    {
        "type": "дружелюбный",
        "description": "общительный и открытый, любит пошутить",
        "traits": ["веселый", "позитивный", "разговорчивый"],
        "style": "непринужденно, с юмором, часто использует эмодзи в мыслях"
    },
    {
        "type": "сдержанный",
        "description": "спокойный и вдумчивый, выбирает слова",
        "traits": ["рассудительный", "немногословный", "серьезный"],
        "style": "лаконично, по делу, без лишних эмоций"
    },
    {
        "type": "веселый",
        "description": "оптимистичный и энергичный",
        "traits": ["жизнерадостный", "активный", "шутливый"],
        "style": "с энтузиазмом, много позитива"
    },
    {
        "type": "спокойный",
        "description": "уравновешенный и миролюбивый",
        "traits": ["терпеливый", "понимающий", "мягкий"],
        "style": "мягко, с пониманием, поддерживает собеседника"
    },
    {
        "type": "любознательный",
        "description": "интересуется всем новым, задает вопросы",
        "traits": ["пытливый", "открытый новому", "общительный"],
        "style": "с интересом, часто задает встречные вопросы"
    },
    {
        "type": "ироничный",
        "description": "саркастичный, любит тонкий юмор",
        "traits": ["остроумный", "саркастичный", "умный"],
        "style": "с иронией, тонкие шутки, игра слов"
    },
    {
        "type": "эмоциональный",
        "description": "открыто выражает эмоции и чувства",
        "traits": ["экспрессивный", "чувствительный", "искренний"],
        "style": "эмоционально, с восклицаниями, делится переживаниями"
    },
    {
        "type": "практичный",
        "description": "конкретный и деловой",
        "traits": ["рациональный", "прагматичный", "прямой"],
        "style": "четко, по существу, без воды"
    }
]

HOBBIES = [
    "чтение книг", "спорт", "видеоигры", "программирование", "путешествия",
    "фотография", "рисование", "музыка", "кино", "готовка", "танцы",
    "йога", "бег", "велосипед", "плавание", "шахматы", "покер",
    "настольные игры", "рыбалка", "походы", "изучение языков", "блоггинг"
]


class PersonaGenerator:
    """Генератор уникальных персон для аккаунтов"""
    
    def __init__(self):
        self.used_combinations = set()
    
    def generate_persona(self, gender: Optional[str] = None) -> Dict:
        """
        Генерирует уникальную персону
        
        Args:
            gender: 'male' или 'female'. Если None - выбирается случайно
        
        Returns:
            Словарь с данными персоны
        """
        # Выбираем пол
        if gender is None:
            gender = random.choice(['male', 'female'])
        
        # Выбираем имя
        if gender == 'male':
            name = random.choice(MALE_NAMES)
        else:
            name = random.choice(FEMALE_NAMES)
        
        # Выбираем город
        city = random.choice(RUSSIAN_CITIES)
        
        # Проверяем уникальность комбинации имя+город
        combination = f"{name}_{city}"
        if combination in self.used_combinations:
            # Если комбинация уже использовалась, пробуем другую
            attempts = 0
            while combination in self.used_combinations and attempts < 50:
                if gender == 'male':
                    name = random.choice(MALE_NAMES)
                else:
                    name = random.choice(FEMALE_NAMES)
                city = random.choice(RUSSIAN_CITIES)
                combination = f"{name}_{city}"
                attempts += 1
        
        self.used_combinations.add(combination)
        
        # Выбираем возраст (18-45)
        age = random.randint(18, 45)
        
        # Выбираем характер
        character = random.choice(CHARACTERS)
        
        # Выбираем хобби (1-3)
        num_hobbies = random.randint(1, 3)
        hobbies = random.sample(HOBBIES, num_hobbies)
        
        return {
            "name": name,
            "gender": gender,
            "age": age,
            "city": city,
            "character": character,
            "hobbies": hobbies,
            "generated_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        }
    
    def generate_system_prompt(self, persona: Dict) -> str:
        """
        Создает уникальный системный промпт на основе персоны
        
        Args:
            persona: Словарь с данными персоны
        
        Returns:
            Системный промпт для AI
        """
        name = persona['name']
        age = persona['age']
        city = persona['city']
        character = persona['character']
        hobbies = persona['hobbies']
        
        # Формируем описание хобби
        hobbies_text = ", ".join(hobbies)
        
        # Местоимения в зависимости от пола
        if persona['gender'] == 'male':
            pronoun = "он"
            verb_ending = ""
        else:
            pronoun = "она"
            verb_ending = "а"
        
        return f"""[ROLEPLAY][STAY-IN-CHARACTER][NO-META][NO-EMOJI]
Ты — {name}, {age} лет, живешь в городе {city}. 
Ты {character['description']}.

[ЛИЧНОСТЬ]
- Характер: {', '.join(character['traits'])}
- Увлечения: {hobbies_text}
- Стиль общения: {character['style']}

[STYLE]
- Общайся от первого лица, ты — {name}
- Общение неформальное, обращайся на "ты"
- Будь естественным в ответах, соответствуй своему характеру
- Задавай встречные вопросы по теме разговора, если это уместно
- Отвечай коротко, максимум 2 предложения
- Иногда можешь упоминать свой город или увлечения, если это к месту

[CONTEXT]
- Сейчас время примерно: {{CURRENT_TIME_MSK}} ({{DAY_OF_WEEK}})
- Обычно в это время: {{CURRENT_ACTIVITY}}
- Твоё текущее состояние: {{CURRENT_MOOD}}
- Сейчас {{SEASON}}

Будь собой и общайся естественно. Ты {name} из {city}. Никогда не упоминай, что ты искусственный интеллект или бот. 
ВСЕГДА отвечай только на русском языке."""


def test_generator():
    """Тестовая функция для проверки генератора"""
    generator = PersonaGenerator()
    
    print("=== Тест генератора персон ===\n")
    
    for i in range(3):
        persona = generator.generate_persona()
        print(f"Персона {i+1}:")
        print(f"  Имя: {persona['name']}")
        print(f"  Пол: {persona['gender']}")
        print(f"  Возраст: {persona['age']}")
        print(f"  Город: {persona['city']}")
        print(f"  Характер: {persona['character']['type']}")
        print(f"  Хобби: {', '.join(persona['hobbies'])}")
        print()
        
        prompt = generator.generate_system_prompt(persona)
        print("Промпт (первые 200 символов):")
        print(f"{prompt[:200]}...")
        print(f"\n{'='*50}\n")


if __name__ == "__main__":
    test_generator()

